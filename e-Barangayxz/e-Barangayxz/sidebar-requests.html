<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>eBarangay | Staff Dashboard - Requests</title>
  <link rel="icon" type="image/jpeg" href="pics/eb-logo.jpg"> <!--FAVICON-->
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="style.css" />
    
</head>
<body>
   <style>
    /* Notification styles moved to style.css (centralized). */

    /* Responsive modal buttons: stack and full-width on small screens */
    .modal .modal-footer .btn {
      min-width: 100px;
    }

    .modal .info-card .mt-3 .btn {
      margin-right: 0.5rem;
    }

    /* message container for proof actions inside modal */
    .proof-message {
      margin-top: 0.5rem;
    }

    @media (max-width: 575.98px) {
      /* Stack modal footer buttons vertically and make them full-width */
      .modal .modal-footer {
        flex-direction: column-reverse;
        gap: 0.5rem;
        align-items: stretch;
      }
      .modal .modal-footer .btn {
        width: 100%;
        min-height: 44px; /* comfortable touch target */
      }

      /* Make inline action buttons in info cards (e.g., payment proof) full width */
      .modal .info-card .mt-3 {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      .modal .info-card .mt-3 .btn {
        width: 100%;
        margin-right: 0;
        min-height: 44px; /* comfortable touch target */
      }

      /* Align text areas properly when buttons stack */
      .modal .modal-body .text-end {
        text-align: left !important;
      }
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top" style="padding: 0.5rem 0; margin-top: -8px; padding-top: calc(0.5rem + 8px);">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="staff-dashboard.html">
        <img src="pics/eb-logo.jpg" alt="eBarangay Logo" class="me-2" style="height:40px; width:auto" />
        <span>STAFF DASHBOARD</span>
      </a>

      <div class="d-flex align-items-center position-relative">
        <!-- Notification Dropdown -->
        <div class="dropdown me-2">
          <button class="btn btn-light position-relative" id="notifButton" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
            <i class="bi bi-bell fs-5"></i>
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="notifBadge">1</span>
          </button>

          <div class="dropdown-menu dropdown-menu-end shadow-sm p-0 border-0" id="notifDropdown" style="width:340px;">
            <div class="p-3 border-bottom bg-light">
              <h6 class="fw-bold mb-0">Notifications</h6>
            </div>

            <!-- Main notifications -->
            <div class="notification-panel">
              <div class="notif-item p-3 border-bottom unread">
                <div class="d-flex align-items-start">
                  <i class="bi bi-bell-fill me-2 text-primary fs-5"></i>
                  <div>
                    <h6 class="mb-1 fw-semibold text-dark">Document Request</h6>
                    <p class="mb-0 small text-secondary">Juan Dela Cruz requested a Barangay Clearance document.</p>
                  </div>
                </div>
              </div>

              <div class="notif-item p-3 border-bottom">
                <div class="d-flex align-items-start">
                  <i class="bi bi-file-earmark-text me-2 text-primary fs-5"></i>
                  <div>
                    <h6 class="mb-1 fw-semibold text-dark">Document Submitted</h6>
                    <p class="mb-0 small text-secondary">Donny Pangilinan submitted a Barangay Clearance request.</p>
                  </div>
                </div>
              </div>

              <div class="notif-item p-3 border-bottom">
                <div class="d-flex align-items-start">
                  <i class="bi bi-hourglass-split me-2 text-primary fs-5"></i>
                  <div>
                    <h6 class="mb-1 fw-semibold text-dark">Approval Pending</h6>
                    <p class="mb-0 small text-secondary">Waiting for approval of Maria Santos' Business Permit request.</p>
                  </div>
                </div>
              </div>

              <!-- Hidden extra notifications -->
              <div class="extra-notifs mt-0">
                <div class="notif-item p-3 border-bottom">
                  <div class="d-flex align-items-start">
                    <i class="bi bi-calendar-event me-2 text-primary fs-5"></i>
                    <div>
                      <h6 class="mb-1 fw-semibold text-dark">Reminder</h6>
                      <p class="mb-0 small text-secondary">Barangay meeting scheduled for October 25.</p>
                    </div>
                  </div>
                </div>

                <div class="notif-item p-3 border-bottom">
                  <div class="d-flex align-items-start">
                    <i class="bi bi-info-circle me-2 text-primary fs-5"></i>
                    <div>
                      <h6 class="mb-1 fw-semibold text-dark">System Update</h6>
                      <p class="mb-0 small text-secondary">New staff portal features have been added.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

  <button class="btn btn-outline-light btn-sm" id="staffLogoutBtn">Logout</button>
      </div>
    </div>
  </nav>

  <!-- First Login Password Change Modal -->
  <div class="modal fade" id="firstLoginPasswordModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="firstLoginPasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-warning">
          <h5 class="modal-title" id="firstLoginPasswordModalLabel">
            <i class="bi bi-shield-exclamation me-2"></i>Password Change Required
          </h5>
        </div>
        <div class="modal-body">
          <div class="alert alert-warning mb-3">
            <i class="bi bi-info-circle me-2"></i>
            <strong>Security Notice:</strong> You are using the default password. For your account's security, you must change your password before continuing.
          </div>
          
          <form id="firstLoginPasswordForm">
            <div class="mb-3">
              <label for="firstLoginOldPassword" class="form-label fw-semibold">Old Password</label>
              <input type="password" class="form-control" id="firstLoginOldPassword" placeholder="Enter current password" required>
            </div>
            <div class="mb-3">
              <label for="firstLoginNewPassword" class="form-label fw-semibold">New Password</label>
              <input type="password" class="form-control" id="firstLoginNewPassword" placeholder="Enter new password" required>
            </div>
            
            <div class="mb-3">
              <label for="firstLoginConfirmPassword" class="form-label fw-semibold">Confirm New Password</label>
              <input type="password" class="form-control" id="firstLoginConfirmPassword" placeholder="Confirm new password" required>
            </div>

            <div class="small text-muted mb-3">
              <strong>Password requirements:</strong>
              <ul class="mb-0 mt-1">
                <li id="firstLogin-rule-length" class="text-muted">At least 8 characters</li>
                <li id="firstLogin-rule-uppercase" class="text-muted">Contains an uppercase letter (A-Z)</li>
                <li id="firstLogin-rule-lowercase" class="text-muted">Contains a lowercase letter (a-z)</li>
                <li id="firstLogin-rule-number" class="text-muted">Contains a number (0-9)</li>
                <li id="firstLogin-rule-special" class="text-muted">Contains a special character (!@#$%^&*)</li>
              </ul>
            </div>

            <div id="firstLoginPasswordError" class="alert alert-danger small d-none"></div>
            <div id="firstLoginPasswordSuccess" class="alert alert-success small d-none"></div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="firstLoginSubmitBtn">
            <i class="bi bi-check-circle me-1"></i>Change Password
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <div class="row">
      <nav class="col-md-3 col-lg-2 d-md-block sidebar p-3 shadow-sm">
        <div class="nav flex-column">
          <a class="nav-link" href="staff-dashboard.html"><i class="bi bi-speedometer2 me-2"></i> Dashboard</a>
          <a class="nav-link active" href="sidebar-requests.html"><i class="bi bi-files me-2"></i> Requests</a>
          <a class="nav-link" href="sidebar-residents.php"><i class="bi bi-people me-2"></i> Residents</a>
          <a class="nav-link" href="sidebar-reports.html"><i class="bi bi-clipboard-data me-2"></i> Reports</a>
          <a class="nav-link" href="sidebar-profile.html"><i class="bi bi-gear me-2"></i> Profile</a>
        </div>
      </nav>

      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">
        <div class="page-header mb-4">
          <h3>Resident Document Requests</h3>
          <small>Manage and process resident document applications efficiently.</small>
        </div>

        <!-- Quick Stats with popovers -->
        <div class="row g-3 mb-4">
          <div class="col-md-3">
            <div class="stat-card bg-primary text-white text-center shadow-sm" 
                 data-bs-toggle="popover" 
                 data-bs-trigger="hover"
                 data-bs-placement="top"
                 data-bs-content="<div class='p-1'>
                   <div class='fw-bold mb-2'>Document Request Breakdown</div>
                   <div class='d-flex justify-content-between mb-1'>
                     <span><i class='bi bi-file-text me-2'></i>Barangay Clearance</span>
                     <strong>45</strong>
                   </div>
                   <div class='d-flex justify-content-between mb-1'>
                     <span><i class='bi bi-house-door me-2'></i>Certificate of Residency</span>
                     <strong>30</strong>
                   </div>
                   <div class='d-flex justify-content-between mb-1'>
                     <span><i class='bi bi-person-badge me-2'></i>Barangay ID</span>
                     <strong>25</strong>
                   </div>
                   <div class='d-flex justify-content-between'>
                     <span><i class='bi bi-shop me-2'></i>Business Permit</span>
                     <strong>20</strong>
                   </div>
                 </div>"
                 data-bs-html="true"
                 role="button">
              <h5>120</h5>
              <p>Total Requests</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card bg-warning text-dark text-center shadow-sm"
                 data-bs-toggle="popover"
                 data-bs-trigger="hover"
                 data-bs-placement="top"
                 data-bs-content="<div class='p-1'>
                   <div class='fw-bold mb-2'><i class='bi bi-hourglass-split me-2'></i>Pending Requests</div>
                   <div class='d-flex justify-content-between mb-1'>
                     <span><i class='bi bi-file-text me-2'></i>Barangay Clearance</span>
                     <strong>15</strong>
                   </div>
                   <div class='d-flex justify-content-between mb-1'>
                     <span><i class='bi bi-house-door me-2'></i>Certificate of Residency</span>
                     <strong>8</strong>
                   </div>
                   <div class='d-flex justify-content-between mb-1'>
                     <span><i class='bi bi-person-badge me-2'></i>Barangay ID</span>
                     <strong>7</strong>
                   </div>
                   <div class='d-flex justify-content-between'>
                     <span><i class='bi bi-shop me-2'></i>Business Permit</span>
                     <strong>5</strong>
                   </div>
                 </div>"
                 data-bs-html="true"
                 role="button">
              <h5>35</h5>
              <p>Pending</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card bg-success text-white text-center shadow-sm"
                 data-bs-toggle="popover"
                 data-bs-trigger="hover"
                 data-bs-placement="top"
                 data-bs-content="<div class='p-1'>
                   <div class='fw-bold mb-2'><i class='bi bi-check-circle me-2'></i>Completed Requests</div>
                   <div class='d-flex justify-content-between mb-1'>
                     <span><i class='bi bi-file-text me-2'></i>Barangay Clearance</span>
                     <strong>25</strong>
                   </div>
                   <div class='d-flex justify-content-between mb-1'>
                     <span><i class='bi bi-house-door me-2'></i>Certificate of Residency</span>
                     <strong>20</strong>
                   </div>
                   <div class='d-flex justify-content-between mb-1'>
                     <span><i class='bi bi-person-badge me-2'></i>Barangay ID</span>
                     <strong>15</strong>
                   </div>
                   <div class='d-flex justify-content-between'>
                     <span><i class='bi bi-shop me-2'></i>Business Permit</span>
                     <strong>10</strong>
                   </div>
                 </div>"
                 data-bs-html="true"
                 role="button">
              <h5>70</h5>
              <p>Completed</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card bg-danger text-white text-center shadow-sm"
                 data-bs-toggle="popover"
                 data-bs-trigger="hover"
                 data-bs-placement="top"
                 data-bs-content="<div class='p-1'>
                   <div class='fw-bold mb-2'><i class='bi bi-x-circle me-2'></i>Rejected Requests</div>
                   <div class='d-flex justify-content-between mb-1'>
                     <span><i class='bi bi-file-text me-2'></i>Barangay Clearance</span>
                     <strong>5</strong>
                   </div>
                   <div class='d-flex justify-content-between mb-1'>
                     <span><i class='bi bi-house-door me-2'></i>Certificate of Residency</span>
                     <strong>2</strong>
                   </div>
                   <div class='d-flex justify-content-between mb-1'>
                     <span><i class='bi bi-person-badge me-2'></i>Barangay ID</span>
                     <strong>3</strong>
                   </div>
                   <div class='d-flex justify-content-between'>
                     <span><i class='bi bi-shop me-2'></i>Business Permit</span>
                     <strong>5</strong>
                   </div>
                 </div>"
                 data-bs-html="true"
                 role="button">
              <h5>15</h5>
              <p>Rejected</p>
            </div>
          </div>
        </div>

        <div class="mb-3">
          <form id="filterForm" class="row g-2 align-items-center">
            <div class="col-12 col-md-4">
              <input type="text" class="form-control" id="searchName" placeholder="Search by Resident Name" style="height: 38px;" />
            </div>
            <div class="col-6 col-md-2">
              <select class="form-select" id="filterStatus" style="height: 38px;">
                <option value="All">All Status</option>
                <option value="Pending">Pending</option>
                <option value="Processing">Processing</option>
                <option value="Completed">Completed</option>
                <option value="Rejected">Rejected</option>
              </select>
            </div>
            <div class="col-6 col-md-2">
              <input type="date" class="form-control" id="filterDate" style="height: 38px;" />
            </div>
            <div class="col">
              <button type="button" class="btn btn-primary d-flex align-items-center gap-2 w-100 filter-refresh-btn" id="applyFilter" 
                style="background-color: #4B0082; height: 38px; justify-content: center;">
                <span class="normal-state">
                  <i class="bi bi-funnel-fill"></i>
                  <span>Filter</span>
                </span>
                <span class="loading-state d-none" style="width: 16px; height: 16px;">
                  <span class="spinner-border spinner-border-sm" style="width: 16px; height: 16px;"></span>
                </span>
              </button>
            </div>
            <div class="col-auto ps-0">
              <button type="button" class="btn btn-success d-flex align-items-center gap-2 filter-refresh-btn" id="refreshBtn" title="Refresh table" 
                style="height: 38px; padding: 0 16px; justify-content: center;">
                <i class="bi bi-arrow-clockwise"></i>
              </button>
            </div>
            <!-- Clear filters removed as requested -->
          </form>
        </div>

        <div class="bulk-actions">
          <span class="fw-bold me-3">Bulk Actions:</span>
          <button class="btn btn-success btn-sm me-2">
            <i class="bi bi-check-circle me-1"></i> Approve Selected
          </button>
          <button class="btn btn-danger btn-sm">
            <i class="bi bi-x-circle me-1"></i> Reject Selected
          </button>
        </div>

        <div class="card shadow-sm border-0">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover align-middle" id="requestsTable">
                <thead class="table-light">
                  <tr>
                    <th><input type="checkbox" id="selectAll" /></th>
                    <th>Resident</th>
                    <th>Document</th>
                    <th>Date Requested</th>
                    <th>Status</th>
                    <th>Payment</th>
                    <th>Release Mode</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr data-release="Download" data-payment="Unpaid">
                    <td><input type="checkbox" class="row-check" /></td>
                    <td>Juan Dela Cruz</td>
                    <td>Barangay Clearance</td>
                    <td>2025-09-20</td>
                    <td><span class="badge bg-warning text-dark">Pending</span></td>
                    <td><span class="badge bg-secondary">Unpaid</span></td>
                    <td>Download</td>
                    <td>
                      <button class="btn btn-sm btn-outline-secondary view-request" data-bs-toggle="modal" data-bs-target="#requestModal"
                        data-request="#REQ-4001"
                        data-date="2025-09-20"
                        data-name="Juan Dela Cruz"
                        data-contact="0917-000-0000"
                        data-address="Brgy. Pulong Buhangin"
                        data-document="Barangay Clearance"
                        data-release="Download"
                        data-payment="Unpaid"
                        data-notes="N/A"
                      >View</button>
                    </td>
                  </tr>
                  <tr data-release="Pickup" data-payment="Cash on Pickup">
                    <td><input type="checkbox" class="row-check" /></td>
                    <td>Maria Santos</td>
                    <td>Certificate of Residency</td>
                    <td>2025-09-19</td>
                    <td><span class="badge bg-info text-dark">Processing</span></td>
                    <td><span class="badge bg-primary">Cash on Pickup</span></td>
                    <td>Pickup</td>
                    <td>
                      <button class="btn btn-sm btn-outline-secondary view-request" data-bs-toggle="modal" data-bs-target="#requestModal"
                        data-request="#REQ-4000"
                        data-date="2025-09-19"
                        data-name="Maria Santos"
                        data-contact="0917-111-2222"
                        data-address="Brgy. San Roque"
                        data-document="Certificate of Residency"
                        data-release="Pickup"
                        data-payment="Cash on Pickup"
                        data-notes="Will pick up after office hours"
                      >View</button>
                    </td>
                  </tr>
                  <tr data-release="Download" data-payment="GCash">
                    <td><input type="checkbox" class="row-check" /></td>
                    <td>Roberto Tan</td>
                    <td>Barangay ID</td>
                    <td>2025-09-18</td>
                    <td><span class="badge bg-warning text-dark">Pending</span></td>
                    <td><span class="badge bg-info text-white">GCash</span></td>
                    <td>Download</td>
                    <td>
                      <button class="btn btn-sm btn-outline-secondary view-request" data-bs-toggle="modal" data-bs-target="#requestModal"
                        data-request="#REQ-4002"
                        data-date="2025-09-18"
                        data-name="Roberto Tan"
                        data-contact="0917-222-3333"
                        data-address="Brgy. San Isidro"
                        data-document="Barangay ID"
                        data-release="Download"
                        data-payment="GCash"
                        data-notes="Uploaded GCash receipt"
                        data-proof="gcash-proof-sample.jpg"
                      >View</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>


  <!-- Request Details Modal (professional header like residents modal) -->
  <div class="modal fade" id="requestModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content border-0 shadow-lg rounded-4">

  <!-- Header (professional multi-color gradient to match residents modal) -->
  <div class="modal-header text-white rounded-top-4" style="background: linear-gradient(135deg, #c5202f, #222c8e, #6a0dad);">
          <h5 class="modal-title fw-bold">
            <i class="bi bi-file-earmark-text me-2"></i> Request Details
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>

        <!-- Scrollable body -->
        <div class="modal-body p-4" style="max-height: 70vh; overflow-y: auto;">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h5 class="fw-bold mb-1" id="modal-name">—</h5>
              <div class="small text-muted" id="modal-contact">Contact: —</div>
              <div class="small text-muted" id="modal-address">Address: —</div>
            </div>
            <div>
              <span class="badge bg-info rounded-pill" id="modal-request-pill">Request</span>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <div class="small text-muted">Request <strong id="modal-request">—</strong></div>
            </div>
            <div class="col-md-6 text-end small text-muted" id="modal-date">—</div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <div class="fw-semibold small text-muted">Requested Document</div>
              <div class="mb-2" id="modal-document">—</div>
            </div>
            <div class="col-md-6">
              <div class="fw-semibold small text-muted">Status</div>
              <div class="mb-2"><strong id="modal-status">—</strong></div>
            </div>
          </div>

          <div class="mb-3">
            <div class="fw-semibold small text-muted">Notes</div>
            <div class="mb-2 small text-muted" id="modal-notes">—</div>
          </div>
          <hr>

          <div class="row mb-3">
            <div class="col-12">
              <div class="info-card" id="gcashSection" style="display:none;">
                <h6><i class="bi bi-cash-stack me-2"></i> Payment Proof (GCash)</h6>
                <p class="mb-2">Resident uploaded GCash transaction screenshot:</p>
                <img id="modal-gcash-img" src="pics/gcash-proof-sample.jpg" alt="GCash Proof" class="img-fluid rounded shadow-sm border" style="max-height:300px;" />
                <div class="mt-3">
                  <button class="btn btn-sm btn-outline-success" id="verifyProofBtn"><i class="bi bi-check2-circle me-1"></i> Verify Payment</button>
                  <button class="btn btn-sm btn-outline-danger" id="invalidProofBtn"><i class="bi bi-x-circle me-1"></i> Invalid Proof</button>
                </div>
                <!-- proof message placeholder (updated dynamically) -->
                <div id="proofMessage" class="proof-message" aria-live="polite"></div>
              </div>
              <div class="info-card" id="cashSection" style="display:none;">
                <h6><i class="bi bi-wallet2 me-2"></i> Payment (Cash)</h6>
                <p class="mb-0 text-muted">Resident will <strong>pay in cash upon claiming</strong> at the barangay hall.</p>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center">
            <div>
              <div class="fw-semibold">Release & Payment</div>
              <div class="small text-muted">Mode: <span id="modal-release">—</span> • Payment: <span id="modal-payment">—</span></div>
            </div>
            <div class="text-end">
              <button class="btn btn-outline-secondary me-2" id="modal-download-proof">Download Proof</button>
            </div>
          </div>
        </div>

        <!-- Footer with action buttons (keeps primary actions; redundant footer Close removed) -->
        <div class="modal-footer border-0 d-flex justify-content-between">
          <div>
            <button class="btn btn-success" id="modal-approve"><i class="bi bi-check-circle me-1"></i> Approve</button>
            <button class="btn btn-danger ms-2" id="modal-reject"><i class="bi bi-x-circle me-1"></i> Reject</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const selectAll = document.getElementById("selectAll");
    const rowChecks = document.querySelectorAll(".row-check");
    const bulkActions = document.querySelector(".bulk-actions");

    selectAll.addEventListener("change", function () {
      rowChecks.forEach((cb) => (cb.checked = selectAll.checked));
      toggleBulkActions();
    });
    rowChecks.forEach((cb) => cb.addEventListener("change", toggleBulkActions));
    function toggleBulkActions() {
      const checked = document.querySelectorAll(".row-check:checked").length;
      bulkActions.style.display = checked > 0 ? "flex" : "none";
      bulkActions.classList.add("align-items-center");
    }

    // New modal population: read data-* from the clicked button and populate modal fields
    const viewButtons = document.querySelectorAll('.view-request');
    const modalName = document.getElementById('modal-name');
    const modalContact = document.getElementById('modal-contact');
    const modalAddress = document.getElementById('modal-address');
    const modalRequest = document.getElementById('modal-request');
    const modalDate = document.getElementById('modal-date');
    const modalDocument = document.getElementById('modal-document');
    const modalStatus = document.getElementById('modal-status');
    const modalNotes = document.getElementById('modal-notes');
    const modalRelease = document.getElementById('modal-release');
    const modalPayment = document.getElementById('modal-payment');
    const gcashSection = document.getElementById('gcashSection');
    const cashSection = document.getElementById('cashSection');

    const requestModalEl = document.getElementById('requestModal');

    viewButtons.forEach(btn => {
      btn.addEventListener('click', function () {
        // prefer data attributes on the button (we added them)
        const get = (k) => this.getAttribute(k) || '';
        modalName.textContent = get('data-name') || this.closest('tr').cells[1].textContent;
        modalContact.textContent = 'Contact: ' + (get('data-contact') || '—');
        modalAddress.textContent = 'Address: ' + (get('data-address') || '—');
        modalRequest.textContent = get('data-request') || '—';
        modalDate.textContent = get('data-date') || this.closest('tr').cells[3].textContent;
        modalDocument.textContent = get('data-document') || this.closest('tr').cells[2].textContent;
        // status: read badge text if available
        const row = this.closest('tr');
        const statusBadge = row.querySelector('td:nth-child(5) .badge');
        modalStatus.textContent = statusBadge ? statusBadge.textContent.trim() : (get('data-status') || '—');
        modalNotes.textContent = get('data-notes') || '—';
        modalRelease.textContent = get('data-release') || row.dataset.release || '—';
        modalPayment.textContent = get('data-payment') || row.dataset.payment || '—';

        // toggle optional payment sections and set proof image when present
        const paymentVal = (get('data-payment') || row.dataset.payment || '').toLowerCase();
        const proofFile = get('data-proof') || '';
        const gcashImg = document.getElementById('modal-gcash-img');
        if (paymentVal.includes('gcash')) {
          if (gcashSection) gcashSection.style.display = 'block';
          if (cashSection) cashSection.style.display = 'none';
          if (gcashImg && proofFile) gcashImg.src = proofFile;
        } else if (paymentVal.includes('cash')) {
          if (gcashSection) gcashSection.style.display = 'none';
          if (cashSection) cashSection.style.display = 'block';
        } else {
          if (gcashSection) gcashSection.style.display = 'none';
          if (cashSection) cashSection.style.display = 'none';
        }

        // Compute visibility for proof action buttons and restore persistent message if present
        const proofMsg = document.getElementById('proofMessage');
        const verifyEl = document.getElementById('verifyProofBtn');
        const invalidEl = document.getElementById('invalidProofBtn');
        // Determine if this request already shows a verified/invalid state in the table or row dataset
        const paymentCellText = row.cells[5] ? row.cells[5].textContent.toLowerCase() : '';
        const proofStatus = row.dataset.proof || (paymentCellText.includes('verified') ? 'verified' : (paymentCellText.includes('invalid') ? 'invalid' : ''));
        const alreadyHandled = proofStatus === 'verified' || proofStatus === 'invalid';
        if (paymentVal.includes('gcash')) {
          if (verifyEl) verifyEl.style.display = alreadyHandled ? 'none' : 'inline-flex';
          if (invalidEl) invalidEl.style.display = alreadyHandled ? 'none' : 'inline-flex';

          // If previously handled, restore the persistent message
          if (alreadyHandled && proofMsg) {
            if (proofStatus === 'verified') showProofMessage('success', 'Payment has been verified.', row.dataset.proofTime || undefined);
            else if (proofStatus === 'invalid') showProofMessage('danger', 'The uploaded proof has been marked as invalid.', row.dataset.proofTime || undefined);
          } else if (proofMsg) {
            // no persistent message for this request
            proofMsg.innerHTML = '';
          }
        } else {
          if (verifyEl) verifyEl.style.display = 'none';
          if (invalidEl) invalidEl.style.display = 'none';
          if (proofMsg) proofMsg.innerHTML = '';
        }

        // store current request id on modal for actions
        requestModalEl.dataset.currentRequest = get('data-request') || '';
        requestModalEl.dataset.currentRowIndex = Array.from(row.parentElement.children).indexOf(row);
      });
    });

    // Approve / Reject handlers (demo only - updates UI locally)
    const approveBtn = document.getElementById('modal-approve');
    const rejectBtn = document.getElementById('modal-reject');

    if (approveBtn) {
      approveBtn.addEventListener('click', function () {
        const idx = requestModalEl.dataset.currentRowIndex;
        if (typeof idx === 'undefined') return;
        const tbody = document.querySelector('#requestsTable tbody');
        const row = tbody.children[idx];
        if (!row) return;
        // set status badge to Completed
        const badgeCell = row.cells[4];
        badgeCell.innerHTML = '<span class="badge bg-success text-white">Completed</span>';
        // update payment badge if unpaid -> leave as is for demo
        // close modal
        const bsModal = bootstrap.Modal.getInstance(requestModalEl);
        if (bsModal) bsModal.hide();
      });
    }

    if (rejectBtn) {
      rejectBtn.addEventListener('click', function () {
        const idx = requestModalEl.dataset.currentRowIndex;
        if (typeof idx === 'undefined') return;
        const tbody = document.querySelector('#requestsTable tbody');
        const row = tbody.children[idx];
        if (!row) return;
        // set status badge to Rejected
        const badgeCell = row.cells[4];
        badgeCell.innerHTML = '<span class="badge bg-danger text-white">Rejected</span>';
        const bsModal = bootstrap.Modal.getInstance(requestModalEl);
        if (bsModal) bsModal.hide();
      });
    }
    // download proof handlers
    const downloadProofBtn = document.getElementById('downloadProofBtn');
    const modalGcashImg = document.getElementById('modal-gcash-img');
    if (downloadProofBtn) {
      downloadProofBtn.addEventListener('click', function () {
        if (!modalGcashImg || !modalGcashImg.src) return;
        const link = document.createElement('a');
        link.href = modalGcashImg.src;
        link.download = modalGcashImg.src.split('/').pop();
        document.body.appendChild(link);
        link.click();
        link.remove();
      });
    }
    // modal-download-proof (footer button) also downloads if available
    const footerDownload = document.getElementById('modal-download-proof');
    if (footerDownload) {
      footerDownload.addEventListener('click', function () {
        if (!modalGcashImg || !modalGcashImg.src) return;
        const link = document.createElement('a');
        link.href = modalGcashImg.src;
        link.download = modalGcashImg.src.split('/').pop();
        document.body.appendChild(link);
        link.click();
        link.remove();
      });
    }

    // Verify / Invalid proof demo buttons -> show responsive in-modal message
    const verifyProofBtn = document.getElementById('verifyProofBtn');
    const invalidProofBtn = document.getElementById('invalidProofBtn');

    function showProofMessage(type, text, timeStr) {
      const container = document.getElementById('proofMessage');
      if (!container) return;
      // play a short notification sound
      try { playNotificationSound(); } catch (e) { /* ignore */ }
      // timestamp - use provided timeStr if present, otherwise use now
      const ts = timeStr ? new Date(timeStr) : new Date();
      const displayTime = ts.toLocaleString();
      const title = type === 'success' ? 'Payment verified' : 'Invalid proof';
      const icon = type === 'success' ? 'bi-check2-circle fs-4 me-2 text-success' : 'bi-x-circle fs-4 me-2 text-danger';

      // Professional alert with close button and subtle fade animation
      container.innerHTML = `
        <div class="alert alert-${type} alert-dismissible fade show d-flex align-items-start" role="alert">
          <div class="me-2"> <i class="bi ${icon}"></i> </div>
          <div class="flex-grow-1">
            <div class="fw-semibold">${title}</div>
            <div class="small text-muted">${text}</div>
            <div class="small text-muted mt-1">${displayTime}</div>
          </div>
          <button type="button" class="btn-close" aria-label="Close" onclick="(function(el){el.innerHTML='';})(document.getElementById('proofMessage'))"></button>
        </div>`;

      // message is persistent until manually closed by the user
      // attach a no-op to the close button for accessibility (closing already clears container)
      const closeBtn = container.querySelector('.btn-close');
      if (closeBtn) closeBtn.addEventListener('click', () => {});
    }


    

    if (verifyProofBtn) verifyProofBtn.addEventListener('click', function () {
      // Show confirmation message inside the modal
  // pass the current time so message shows when it happened
  const nowISO = new Date().toISOString();
  showProofMessage('success', 'Payment has been verified.', nowISO);

      // Hide verify/invalid buttons to prevent duplicate actions
      verifyProofBtn.style.display = 'none';
      if (invalidProofBtn) invalidProofBtn.style.display = 'none';

      // Update modal payment text to reflect verification
      modalPayment.textContent = 'GCash (Verified)';

      // Update the payment badge in the requests table (demo local update)
      const idx = requestModalEl.dataset.currentRowIndex;
      if (typeof idx !== 'undefined' && idx !== null && idx !== '') {
        const tbody = document.querySelector('#requestsTable tbody');
        const row = tbody.children[Number(idx)];
        if (row) {
          const paymentCell = row.cells[5];
          if (paymentCell) paymentCell.innerHTML = '<span class="badge bg-success text-white">GCash (Verified)</span>';
          // mark row as handled so the message persists when reopening
          row.dataset.proof = 'verified';
          row.dataset.proofTime = nowISO;
        }
      }
    });

    if (invalidProofBtn) invalidProofBtn.addEventListener('click', function () {
      // Show invalid message
  const nowISO = new Date().toISOString();
  showProofMessage('danger', 'The uploaded proof has been marked as invalid.', nowISO);

      // Hide verify/invalid buttons
      if (verifyProofBtn) verifyProofBtn.style.display = 'none';
      invalidProofBtn.style.display = 'none';

      // Update modal payment text to reflect invalid proof
      modalPayment.textContent = 'Invalid Proof';

      // Update the payment badge in the requests table to indicate invalid proof
      const idx = requestModalEl.dataset.currentRowIndex;
      if (typeof idx !== 'undefined' && idx !== null && idx !== '') {
        const tbody = document.querySelector('#requestsTable tbody');
        const row = tbody.children[Number(idx)];
        if (row) {
          const paymentCell = row.cells[5];
          if (paymentCell) paymentCell.innerHTML = '<span class="badge bg-danger text-white">Invalid Proof</span>';
          // mark row as handled so the message persists when reopening
          row.dataset.proof = 'invalid';
          row.dataset.proofTime = nowISO;
        }
      }
    });
    

    document.addEventListener("DOMContentLoaded", () => {
      const notifButton = document.getElementById("notifButton");
      const notifBadge = document.getElementById("notifBadge");
      const extraNotifs = document.querySelector(".extra-notifs");

      notifButton.addEventListener("click", () => notifBadge.style.display = "none");

      // Play sound when new notification items are added to the notification panel
      const notifPanel = document.querySelector('.notification-panel');
      if (notifPanel) {
        // record initial items to avoid playing sound on initial load
        let initialCount = notifPanel.querySelectorAll('.notif-item').length;
        const mo = new MutationObserver(muts => {
          muts.forEach(m => {
            if (m.addedNodes && m.addedNodes.length) {
              // if count increased beyond initial, play sound for new nodes
              const newItems = Array.from(m.addedNodes).filter(n => n.classList && n.classList.contains('notif-item'));
              if (newItems.length) {
                try { playNotificationSound(); } catch(e){}
              }
              // update initialCount so subsequent adds still trigger
              initialCount = notifPanel.querySelectorAll('.notif-item').length;
            }
          });
        });
        mo.observe(notifPanel, { childList: true, subtree: false });
      }

      // When the dropdown is shown, optionally play a sound if there are unread items
      const dropdownEl = document.getElementById('notifButton');
      if (dropdownEl) {
        dropdownEl.addEventListener('shown.bs.dropdown', function () {
          const unread = document.querySelectorAll('.notification-panel .notif-item.unread').length;
          if (unread > 0) { try { playNotificationSound(); } catch(e){} }
        });
      }

      toggleExtraBtn.addEventListener("click", (e) => {
        e.stopPropagation(); // keep dropdown open
        e.preventDefault();

        const isExpanded = extraNotifs.classList.contains("show");
        extraNotifs.classList.toggle("show");

        toggleExtraBtn.textContent = isExpanded
          ? "See Previous Notifications →"
          : "Hide Previous Notifications ↑";
      });
    });

    // Initialize all popovers
    const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]');
    const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl));

    // Filter functionality
    document.addEventListener('DOMContentLoaded', function() {
      const applyFilterBtn = document.getElementById('applyFilter');
      const filterForm = document.getElementById('filterForm');
      const searchName = document.getElementById('searchName');
      const filterStatus = document.getElementById('filterStatus');
      const filterDate = document.getElementById('filterDate');
      const table = document.getElementById('requestsTable');
      const tbody = table.querySelector('tbody');
      
      // Store original table state
      const originalRows = Array.from(tbody.getElementsByTagName('tr')).map(row => row.cloneNode(true));

      applyFilterBtn.addEventListener('click', function() {
        // Show loading state
        const normalState = applyFilterBtn.querySelector('.normal-state');
        const loadingState = applyFilterBtn.querySelector('.loading-state');
        normalState.classList.add('d-none');
        loadingState.classList.remove('d-none');
        applyFilterBtn.disabled = true;

        // Simulate filter processing delay
        setTimeout(() => {
          // Clear existing table
          tbody.innerHTML = '';
          
          // Get filter values
          const nameFilter = searchName.value.toLowerCase();
          const statusFilter = filterStatus.value;
          const dateFilter = filterDate.value;
          
          let matchCount = 0;
          let totalRequests = 0;
          let pendingRequests = 0;
          let completedRequests = 0;
          let rejectedRequests = 0;

          // Apply filters
          originalRows.forEach(originalRow => {
            const row = originalRow.cloneNode(true);
            const name = row.cells[1].textContent.toLowerCase();
            const status = row.querySelector('.badge').textContent.trim();
            const date = row.cells[3].textContent;
            
            const matchesName = nameFilter === '' || name.includes(nameFilter);
            const matchesStatus = statusFilter === 'All' || status === statusFilter;
            const matchesDate = dateFilter === '' || date === dateFilter;

            if (matchesName && matchesStatus && matchesDate) {
              tbody.appendChild(row);
              matchCount++;
              
              // Update stats
              totalRequests++;
              if (status.includes('Pending')) pendingRequests++;
              if (status.includes('Completed')) completedRequests++;
              if (status.includes('Rejected')) rejectedRequests++;
            }
          });

          // Reattach event listeners to new rows
          attachViewButtonListeners();

          // Show no results message if needed
          if (matchCount === 0) {
            const noResultsRow = document.createElement('tr');
            noResultsRow.innerHTML = `
              <td colspan="8" class="text-center py-4">
                <div class="text-muted">
                  <i class="bi bi-search me-2"></i>
                  No requests match your filter criteria
                </div>
              </td>
            `;
            tbody.appendChild(noResultsRow);
          }

          // Update stats cards
          updateStats({
            total: totalRequests,
            pending: pendingRequests,
            completed: completedRequests,
            rejected: rejectedRequests
          });

          // Reset button state
          normalState.classList.remove('d-none');
          loadingState.classList.add('d-none');
          applyFilterBtn.disabled = false;
        }, 600);
      });

      // Function to update stats cards
      function updateStats(stats) {
        const statCards = document.querySelectorAll('.stat-card h5');
        statCards[0].textContent = stats.total;
        statCards[1].textContent = stats.pending;
        statCards[2].textContent = stats.completed;
        statCards[3].textContent = stats.rejected;
      }

      // Function to attach event listeners to view buttons
      function attachViewButtonListeners() {
        const viewButtons = document.querySelectorAll('.view-request');
        viewButtons.forEach(btn => {
          btn.addEventListener('click', function () {
            const get = (k) => this.getAttribute(k) || '';
            modalName.textContent = get('data-name') || this.closest('tr').cells[1].textContent;
            modalContact.textContent = 'Contact: ' + (get('data-contact') || '—');
            modalAddress.textContent = 'Address: ' + (get('data-address') || '—');
            modalRequest.textContent = get('data-request') || '—';
            modalDate.textContent = get('data-date') || this.closest('tr').cells[3].textContent;
            modalDocument.textContent = get('data-document') || this.closest('tr').cells[2].textContent;
            
            const row = this.closest('tr');
            const statusBadge = row.querySelector('td:nth-child(5) .badge');
            modalStatus.textContent = statusBadge ? statusBadge.textContent.trim() : (get('data-status') || '—');
            modalNotes.textContent = get('data-notes') || '—';
            modalRelease.textContent = get('data-release') || row.dataset.release || '—';
            modalPayment.textContent = get('data-payment') || row.dataset.payment || '—';

            const paymentVal = (get('data-payment') || row.dataset.payment || '').toLowerCase();
            const proofFile = get('data-proof') || '';
            const gcashImg = document.getElementById('modal-gcash-img');
            if (paymentVal.includes('gcash')) {
              if (gcashSection) gcashSection.style.display = 'block';
              if (cashSection) cashSection.style.display = 'none';
              if (gcashImg && proofFile) gcashImg.src = proofFile;
            } else if (paymentVal.includes('cash')) {
              if (gcashSection) gcashSection.style.display = 'none';
              if (cashSection) cashSection.style.display = 'block';
            } else {
              if (gcashSection) gcashSection.style.display = 'none';
              if (cashSection) cashSection.style.display = 'none';
            }

            const proofMsg = document.getElementById('proofMessage');
            const verifyEl = document.getElementById('verifyProofBtn');
            const invalidEl = document.getElementById('invalidProofBtn');
            const paymentCellText = row.cells[5] ? row.cells[5].textContent.toLowerCase() : '';
            const proofStatus = row.dataset.proof || (paymentCellText.includes('verified') ? 'verified' : (paymentCellText.includes('invalid') ? 'invalid' : ''));
            const alreadyHandled = proofStatus === 'verified' || proofStatus === 'invalid';
            if (paymentVal.includes('gcash')) {
              if (verifyEl) verifyEl.style.display = alreadyHandled ? 'none' : 'inline-flex';
              if (invalidEl) invalidEl.style.display = alreadyHandled ? 'none' : 'inline-flex';

              if (alreadyHandled && proofMsg) {
                if (proofStatus === 'verified') showProofMessage('success', 'Payment has been verified.', row.dataset.proofTime || undefined);
                else if (proofStatus === 'invalid') showProofMessage('danger', 'The uploaded proof has been marked as invalid.', row.dataset.proofTime || undefined);
              } else if (proofMsg) {
                proofMsg.innerHTML = '';
              }
            } else {
              if (verifyEl) verifyEl.style.display = 'none';
              if (invalidEl) invalidEl.style.display = 'none';
              if (proofMsg) proofMsg.innerHTML = '';
            }

            requestModalEl.dataset.currentRequest = get('data-request') || '';
            requestModalEl.dataset.currentRowIndex = Array.from(row.parentElement.children).indexOf(row);
          });
        });
      }

      // Clear-filters UI was removed; Refresh will restore original data (see below)

      // Refresh button functionality
      const refreshBtn = document.getElementById('refreshBtn');
      refreshBtn.addEventListener('click', function() {
        // Add spinning animation to the icon
        const icon = refreshBtn.querySelector('i');
        icon.classList.add('spin-animation');
        refreshBtn.disabled = true;
        
        // Simulate refresh (in real app, this would fetch from server)
        setTimeout(() => {
          // Restore filter inputs to default
          searchName.value = '';
          filterStatus.value = 'All';
          filterDate.value = '';

          // Restore original table state
          tbody.innerHTML = '';
          originalRows.forEach(row => tbody.appendChild(row.cloneNode(true)));

          // Reattach event listeners
          attachViewButtonListeners();

          // Reset stats
          updateStats({
            total: 120,
            pending: 35,
            completed: 70,
            rejected: 15
          });

          // Remove spin animation
          icon.classList.remove('spin-animation');
          refreshBtn.disabled = false;

          // Show success feedback
          const originalText = refreshBtn.querySelector('span').textContent;
          refreshBtn.querySelector('span').textContent = 'Refreshed!';
          setTimeout(() => {
            refreshBtn.querySelector('span').textContent = originalText;
          }, 1000);
        }, 800);
      });

      // Add tooltip to refresh button
      new bootstrap.Tooltip(refreshBtn, {
        title: 'Refresh Table Data',
        placement: 'top'
      });
    });
  </script>
  <style>
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .spin-animation {
      animation: spin 0.8s linear infinite;
    }
    /* Hover effects for filter and refresh buttons */
    .filter-refresh-btn {
      transition: all 0.3s ease !important;
    }
    #applyFilter:hover {
      /* Match sidebar-residents filter hover gradient */
      background: linear-gradient(135deg, #6a0dad, #c5202f) !important;
      color: #fff !important;
      filter: brightness(0.98);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(75, 0, 130, 0.18);
    }
    #refreshBtn:hover {
      background-color: #28a745 !important;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
    }
    #applyFilter:active, #refreshBtn:active {
      transform: translateY(0);
    }
  </style>

  <script>
    // Check if staff needs to change default password
    async function checkDefaultPassword() {
      try {
        const response = await fetch('check_default_password.php', {
          method: 'GET',
          cache: 'no-store'
        });
        
        const result = await response.json();
        
        if (result.success && result.isDefaultPassword) {
          const modal = new bootstrap.Modal(document.getElementById('firstLoginPasswordModal'));
          modal.show();
        }
      } catch (error) {
        console.error('Error checking default password:', error);
      }
    }

    function validateFirstLoginPassword(password) {
      const rules = {
        length: password.length >= 8,
        uppercase: /[A-Z]/.test(password),
        lowercase: /[a-z]/.test(password),
        number: /[0-9]/.test(password),
        special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
      };
      
      document.getElementById('firstLogin-rule-length').className = rules.length ? 'text-success' : 'text-muted';
      document.getElementById('firstLogin-rule-uppercase').className = rules.uppercase ? 'text-success' : 'text-muted';
      document.getElementById('firstLogin-rule-lowercase').className = rules.lowercase ? 'text-success' : 'text-muted';
      document.getElementById('firstLogin-rule-number').className = rules.number ? 'text-success' : 'text-muted';
      document.getElementById('firstLogin-rule-special').className = rules.special ? 'text-success' : 'text-muted';
      
      return Object.values(rules).every(Boolean);
    }

    document.getElementById('firstLoginNewPassword')?.addEventListener('input', function() {
      if (this.value) {
        validateFirstLoginPassword(this.value);
      }
    });

    document.getElementById('firstLoginSubmitBtn')?.addEventListener('click', async function() {
      const newPassword = document.getElementById('firstLoginNewPassword').value;
      const confirmPassword = document.getElementById('firstLoginConfirmPassword').value;
      const errorDiv = document.getElementById('firstLoginPasswordError');
      const successDiv = document.getElementById('firstLoginPasswordSuccess');
      const submitBtn = this;

      errorDiv.classList.add('d-none');
      successDiv.classList.add('d-none');

      if (newPassword !== confirmPassword) {
        errorDiv.textContent = 'Passwords do not match';
        errorDiv.classList.remove('d-none');
        return;
      }

      if (!validateFirstLoginPassword(newPassword)) {
        errorDiv.textContent = 'Password does not meet all requirements';
        errorDiv.classList.remove('d-none');
        return;
      }

      try {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>Changing...';

        const formData = new FormData();
        formData.append('new_password', newPassword);

        const response = await fetch('change_first_login_password.php', {
          method: 'POST',
          body: formData,
          cache: 'no-store'
        });

        const result = await response.json();

        if (result.success) {
          successDiv.textContent = 'Password changed successfully! Refreshing...';
          successDiv.classList.remove('d-none');
          
          setTimeout(() => {
            location.reload();
          }, 1500);
        } else {
          errorDiv.textContent = result.message || 'Failed to change password';
          errorDiv.classList.remove('d-none');
          submitBtn.disabled = false;
          submitBtn.innerHTML = '<i class="bi bi-check-circle me-1"></i>Change Password';
        }
      } catch (error) {
        console.error('Password change error:', error);
        errorDiv.textContent = 'An error occurred. Please try again.';
        errorDiv.classList.remove('d-none');
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="bi bi-check-circle me-1"></i>Change Password';
      }
    });

    document.addEventListener('DOMContentLoaded', function() {
      checkDefaultPassword();
    });

    // Staff logout functionality
    document.getElementById('staffLogoutBtn')?.addEventListener('click', async function() {
      try {
        const staffId = sessionStorage.getItem('staff_id');
        
        if (!staffId) {
          window.location.href = 'staff-login.html';
          return;
        }
        
        const formData = new FormData();
        formData.append('staff_id', staffId);
        
        const response = await fetch('log_logout.php', {
          method: 'POST',
          body: formData,
          cache: 'no-store'
        });
        
        const result = await response.json();
        
        if (result.success) {
          sessionStorage.clear();
          window.location.href = 'staff-login.html';
        } else {
          console.error('Logout logging failed:', result.error);
          sessionStorage.clear();
          window.location.href = 'staff-login.html';
        }
      } catch (error) {
        console.error('Logout error:', error);
        sessionStorage.clear();
        window.location.href = 'staff-login.html';
      }
    });
  </script>
</body>
</html>
